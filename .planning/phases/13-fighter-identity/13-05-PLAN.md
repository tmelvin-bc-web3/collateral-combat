---
phase: 13-fighter-identity
plan: 05
type: execute
wave: 1
depends_on: []
files_modified:
  - web/src/app/profile/[wallet]/page.tsx
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "Trading style stats (aggression score, avg leverage, long/short ratio) displayed on profile"
    - "Favorite assets with win rates displayed on profile"
    - "Both UI sections only appear when user has battle history"
  artifacts:
    - path: "web/src/app/profile/[wallet]/page.tsx"
      provides: "Trading style and favorite assets display"
      contains: "tradingStyle.aggressionScore"
      contains: "favoriteAssets"
  key_links:
    - from: "web/src/app/profile/[wallet]/page.tsx"
      to: "/api/battles/favorites/:wallet"
      via: "fetch in useEffect"
      pattern: "fetch.*api/battles/favorites"
    - from: "web/src/app/profile/[wallet]/page.tsx"
      to: "tradingStyle state"
      via: "JSX rendering"
      pattern: "tradingStyle\\."
---

<objective>
Close PROF-05 and PROF-06 verification gaps by adding UI rendering for trading style stats and favorite assets on the profile page.

Purpose: The backend infrastructure for trading style and favorite assets is complete and functional. The profile page fetches trading style data but never displays it, and never fetches favorite assets at all. This plan adds the missing UI sections to expose this data to users.

Output: Updated profile page with Trading Style card (aggression score, avg leverage, long/short ratio) and Favorite Assets card (top 3 assets with win rates).
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/13-fighter-identity/13-VERIFICATION.md

# Key source file
@web/src/app/profile/[wallet]/page.tsx

# Backend types for reference
# TradingStyle: { totalPositions: number, avgLeverage: number, aggressionScore: number (0-100), longShortRatio: number }
# FavoriteAsset: { asset: string, count: number, winRate: number }
# API: GET /api/battles/favorites/:wallet returns { favorites: FavoriteAsset[] }
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add favorite assets state and fetch</name>
  <files>web/src/app/profile/[wallet]/page.tsx</files>
  <action>
Add state and fetch for favorite assets:

1. Add state variable after line 202 (after tradingStyle state):
```typescript
const [favoriteAssets, setFavoriteAssets] = useState<Array<{ asset: string; count: number; winRate: number }>>([]);
```

2. Add fetch to the parallel Promise.all (line 223):
   - Add `favoritesRes` to the destructuring
   - Add fetch: `fetch(\`\${BACKEND_URL}/api/battles/favorites/\${walletAddress}\`)`

3. Add processing for favorites after the tradingStyle processing block (after line 348):
```typescript
// Process favorite assets
if (favoritesRes.ok) {
  const favoritesData = await favoritesRes.json();
  setFavoriteAssets(favoritesData.favorites || []);
}
```

Do NOT change any other existing code. Only add the new state, fetch, and processing.
  </action>
  <verify>
Run `cd /Users/taylermelvin/Desktop/sol-battles/web && pnpm run build` - should compile without errors
Grep for `favoriteAssets` in the file - should find state declaration, fetch, and processing
  </verify>
  <done>
favoriteAssets state declared, fetched from /api/battles/favorites/:wallet, and processed into state
  </done>
</task>

<task type="auto">
  <name>Task 2: Add Trading Style and Favorite Assets UI cards</name>
  <files>web/src/app/profile/[wallet]/page.tsx</files>
  <action>
Add two new cards to the Battle Stats section grid (inside the existing grid at line 618):

**Trading Style Card** - Add after the Recent Form card (around line 699), still inside the grid:
```tsx
{/* Trading Style */}
{tradingStyle && tradingStyle.totalPositions > 0 && (
  <div className="card border border-violet-500/20 p-3 sm:p-4">
    <div className="flex items-center gap-2 mb-2">
      <div className="w-7 h-7 sm:w-8 sm:h-8 rounded-lg bg-violet-500/20 flex items-center justify-center border border-violet-500/30">
        <svg className="w-3.5 h-3.5 sm:w-4 sm:h-4 text-violet-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={2}>
          <path strokeLinecap="round" strokeLinejoin="round" d="M13 10V3L4 14h7v7l9-11h-7z" />
        </svg>
      </div>
      <span className="text-[10px] sm:text-xs text-text-tertiary uppercase tracking-wider">Trading Style</span>
    </div>
    <div className="space-y-2">
      <div className="flex items-center justify-between">
        <span className="text-[10px] sm:text-xs text-text-tertiary">Aggression</span>
        <span className="font-mono font-bold text-violet-400">{tradingStyle.aggressionScore}/100</span>
      </div>
      <div className="flex items-center justify-between">
        <span className="text-[10px] sm:text-xs text-text-tertiary">Avg Leverage</span>
        <span className="font-mono font-bold text-accent">{tradingStyle.avgLeverage.toFixed(1)}x</span>
      </div>
      <div className="flex items-center justify-between">
        <span className="text-[10px] sm:text-xs text-text-tertiary">Long/Short</span>
        <span className={cn(
          'font-mono font-bold',
          tradingStyle.longShortRatio > 1 ? 'text-success' : tradingStyle.longShortRatio < 1 ? 'text-danger' : 'text-text-secondary'
        )}>
          {tradingStyle.longShortRatio.toFixed(2)}:1
        </span>
      </div>
    </div>
  </div>
)}
```

**Favorite Assets Card** - Add after the Trading Style card:
```tsx
{/* Favorite Assets */}
{favoriteAssets.length > 0 && (
  <div className="card border border-amber-500/20 p-3 sm:p-4">
    <div className="flex items-center gap-2 mb-2">
      <div className="w-7 h-7 sm:w-8 sm:h-8 rounded-lg bg-amber-500/20 flex items-center justify-center border border-amber-500/30">
        <svg className="w-3.5 h-3.5 sm:w-4 sm:h-4 text-amber-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={2}>
          <path strokeLinecap="round" strokeLinejoin="round" d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z" />
        </svg>
      </div>
      <span className="text-[10px] sm:text-xs text-text-tertiary uppercase tracking-wider">Favorite Assets</span>
    </div>
    <div className="space-y-1.5">
      {favoriteAssets.map((asset) => (
        <div key={asset.asset} className="flex items-center justify-between">
          <span className="font-mono font-bold text-sm">{asset.asset}</span>
          <span className={cn(
            'text-xs font-medium',
            asset.winRate >= 50 ? 'text-success' : 'text-danger'
          )}>
            {asset.winRate}%
          </span>
        </div>
      ))}
    </div>
  </div>
)}
```

Important notes:
- Both cards conditionally render based on data availability (tradingStyle.totalPositions > 0, favoriteAssets.length > 0)
- Use the same card styling pattern as existing Battle Stats cards
- violet-500 for Trading Style (matches battle theme), amber-500 for Favorite Assets (star/highlight theme)
- cn utility is already imported (line 6)
  </action>
  <verify>
Run `cd /Users/taylermelvin/Desktop/sol-battles/web && pnpm run build` - should compile without errors
Grep for `tradingStyle.aggressionScore` in the file - should find JSX rendering
Grep for `favoriteAssets.map` in the file - should find JSX rendering
  </verify>
  <done>
Trading Style card displays aggression score, avg leverage, long/short ratio
Favorite Assets card displays top 3 assets with win rates
Both cards only render when data is available
  </done>
</task>

</tasks>

<verification>
After completing both tasks:

1. **Build verification**: `cd /Users/taylermelvin/Desktop/sol-battles/web && pnpm run build` passes without errors

2. **Code verification**:
   - Grep for `favoriteAssets` - should find state, fetch, processing, and rendering
   - Grep for `tradingStyle.aggressionScore` - should find JSX rendering (closes PROF-05 gap)
   - Grep for `api/battles/favorites` - should find fetch call (closes PROF-06 gap)

3. **Pattern verification**:
   - Both cards use conditional rendering (only show when data exists)
   - Both cards follow existing card styling patterns in Battle Stats section
</verification>

<success_criteria>
- PROF-05 CLOSED: Trading style data (aggressionScore, avgLeverage, longShortRatio) rendered in UI
- PROF-06 CLOSED: Favorite assets fetched from /api/battles/favorites/:wallet and displayed with win rates
- Build passes without errors
- Cards only display when user has battle history (follows existing pattern)
</success_criteria>

<output>
After completion, create `.planning/phases/13-fighter-identity/13-05-SUMMARY.md`
</output>
