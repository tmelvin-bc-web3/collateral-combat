---
phase: 11-spectator-experience
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - web/src/components/SpectatorView.tsx
  - web/src/components/spectate/FighterPositionCard.tsx
autonomous: true

must_haves:
  truths:
    - "Spectator sees both fighters' positions with entry price, size, leverage, and PnL"
    - "Liquidation distance indicator shows color-coded risk level for each position"
    - "Position cards update in real-time as battle progresses"
  artifacts:
    - path: "web/src/components/spectate/FighterPositionCard.tsx"
      provides: "Fighter position display with liquidation indicator"
      exports: ["FighterPositionCard"]
    - path: "web/src/components/SpectatorView.tsx"
      provides: "Enhanced spectator view with fighter cards"
      contains: "FighterPositionCard"
  key_links:
    - from: "web/src/components/SpectatorView.tsx"
      to: "FighterPositionCard"
      via: "import and render for both fighters"
      pattern: "<FighterPositionCard"
    - from: "FighterPositionCard"
      to: "LiquidationIndicator"
      via: "import from battle components"
      pattern: "import.*LiquidationIndicator"
---

<objective>
Create enhanced fighter position cards with liquidation distance indicators for spectator view.

Purpose: Spectators need to see exactly what positions each fighter holds and how close they are to liquidation - this drives betting decisions and engagement.

Output: FighterPositionCard component with liquidation indicators, integrated into SpectatorView.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/11-spectator-experience/11-RESEARCH.md
@.planning/phases/10-battle-core/10-06-SUMMARY.md

# Existing components to extend/use
@web/src/components/SpectatorView.tsx
@web/src/components/battle/LiquidationIndicator.tsx
@web/src/types/index.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create FighterPositionCard component</name>
  <files>web/src/components/spectate/FighterPositionCard.tsx</files>
  <action>
Create new component that displays a single fighter's position with:

1. Fighter header: Label (Fighter 1/2), truncated wallet address, leading indicator
2. Position list with each position showing:
   - Asset name and leverage badge (e.g., "SOL 10x")
   - Side badge (LONG green, SHORT red)
   - Entry price and current size
   - Unrealized PnL (percentage and dollar amount, color-coded)
   - LiquidationIndicator component (reuse from Phase 10)
3. Account summary: Total balance, total positions, overall PnL

Import LiquidationIndicator from '@/components/battle/LiquidationIndicator'.

Props interface:
```typescript
interface FighterPositionCardProps {
  fighter: BattlePlayer;
  label: string; // "Fighter 1" or "Fighter 2"
  isLeading: boolean;
  compact?: boolean; // For mobile view
}
```

Use existing renderPosition pattern from SpectatorView as starting point but enhance with:
- LiquidationIndicator for each position (using position.liquidationDistance)
- Compact mode for mobile (fewer details)
- Better visual hierarchy

Style using existing Tailwind patterns:
- Glass-morphism: `bg-black/40 backdrop-blur border border-white/10`
- Success/danger colors for PnL
- Responsive with sm: breakpoints
  </action>
  <verify>
```bash
cd /Users/taylermelvin/Desktop/sol-battles/web && pnpm build 2>&1 | head -50
```
Component compiles without TypeScript errors.
  </verify>
  <done>FighterPositionCard.tsx exists with LiquidationIndicator integration and all required props.</done>
</task>

<task type="auto">
  <name>Task 2: Integrate FighterPositionCard into SpectatorView</name>
  <files>web/src/components/SpectatorView.tsx</files>
  <action>
Update SpectatorView to use the new FighterPositionCard component:

1. Import FighterPositionCard from '@/components/spectate/FighterPositionCard'

2. Replace the inline "Player 1 Positions" and "Player 2 Positions" Card sections (lines ~281-320) with:
```tsx
<div className="grid md:grid-cols-2 gap-4">
  {player1 && (
    <FighterPositionCard
      fighter={player1}
      label="Fighter 1"
      isLeading={player1Leading}
    />
  )}
  {player2 && (
    <FighterPositionCard
      fighter={player2}
      label="Fighter 2"
      isLeading={player2Leading}
    />
  )}
</div>
```

3. Remove the old inline `renderPosition` function since it's now in FighterPositionCard.

4. Keep all other SpectatorView functionality intact (timer, header, chart, betting panel).

This satisfies VIEW-01 (both fighters' positions displayed) and VIEW-03 (liquidation distance indicators).
  </action>
  <verify>
```bash
cd /Users/taylermelvin/Desktop/sol-battles/web && pnpm build 2>&1 | head -50
```
Build succeeds. SpectatorView renders both FighterPositionCard components.
  </verify>
  <done>SpectatorView uses FighterPositionCard for both fighters with liquidation indicators visible.</done>
</task>

</tasks>

<verification>
After both tasks:
1. `pnpm build` passes in web directory
2. SpectatorView imports and renders FighterPositionCard for both fighters
3. Each position shows LiquidationIndicator with color-coded status
4. Position data (entry, size, PnL) is visible for all positions
</verification>

<success_criteria>
- VIEW-01: Both fighters' positions visible with entry, size, leverage, PnL
- VIEW-03: Liquidation distance indicator shown for each position
- No TypeScript errors
- Responsive layout maintained (md:grid-cols-2)
</success_criteria>

<output>
After completion, create `.planning/phases/11-spectator-experience/11-01-SUMMARY.md`
</output>
