---
phase: 11-spectator-experience
plan: 03
type: execute
wave: 2
depends_on: ["11-01", "11-02"]
files_modified:
  - web/src/components/SpectatorView.tsx
autonomous: true

must_haves:
  truths:
    - "Price chart overlay is visible in spectator view"
    - "Battle viewer is mobile-responsive with stacked layout on small screens"
    - "Chart is collapsible/minimized on mobile to prioritize battle data"
  artifacts:
    - path: "web/src/components/SpectatorView.tsx"
      provides: "Mobile-responsive spectator view with chart overlay"
      contains: ["TradingViewChart", "lg:grid-cols-3", "md:grid-cols-2"]
  key_links:
    - from: "web/src/components/SpectatorView.tsx"
      to: "TradingViewChart"
      via: "conditional render based on viewport"
      pattern: "TradingViewChart.*symbol"
---

<objective>
Add TradingView chart overlay and make SpectatorView fully mobile-responsive.

Purpose: Spectators need price context to understand battles, but on mobile the battle data (who's winning, positions) must take priority over charts.

Output: Mobile-responsive SpectatorView with collapsible chart and proper layout breakpoints.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/11-spectator-experience/11-RESEARCH.md
@.planning/phases/11-spectator-experience/11-01-PLAN.md
@.planning/phases/11-spectator-experience/11-02-PLAN.md

# Existing components
@web/src/components/SpectatorView.tsx
@web/src/components/TradingViewChart.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Rework SpectatorView layout for mobile responsiveness</name>
  <files>web/src/components/SpectatorView.tsx</files>
  <action>
Restructure SpectatorView for mobile-first responsive design:

1. Update the main content grid layout:
```tsx
{/* Changed from lg:grid-cols-3 to mobile-first */}
<div className="flex flex-col lg:grid lg:grid-cols-3 gap-4 lg:gap-6">
  {/* Main battle content - 2/3 width on desktop */}
  <div className="lg:col-span-2 space-y-4 lg:space-y-6 order-1">
    {/* Tug-of-war bar at top */}
    {/* Chart section with collapsible on mobile */}
    {/* Fighter position cards grid */}
  </div>

  {/* Betting panel - sidebar on desktop, below content on mobile */}
  <div className="lg:col-span-1 order-2">
    <BettingPanel ... />
  </div>
</div>
```

2. Update the fighter position cards grid:
```tsx
<div className="grid grid-cols-1 md:grid-cols-2 gap-3 lg:gap-4">
  {/* Stacked on mobile, side-by-side on tablet+ */}
</div>
```

3. Update the main battle header (timer, players) for mobile:
- Reduce padding on mobile: `p-4 sm:p-6`
- Smaller timer text: `text-3xl sm:text-5xl`
- Simplify player cards on mobile: Hide balance on small screens
- Grid the player comparison: `grid grid-cols-1 sm:grid-cols-3`

4. Make the top bar (back button, live badge, spectators) stack properly:
- `flex flex-wrap items-center justify-between gap-3 mb-4 sm:mb-6 mt-4 sm:mt-8`

5. Add safe-area padding for mobile notch/home indicator:
- Add `pb-20 lg:pb-0` to main container (space for quick bet strip from Plan 04)

Key breakpoints:
- Default (mobile): Single column, stacked elements
- `sm:` (640px): Larger text, player cards side-by-side in header
- `md:` (768px): Fighter cards side-by-side
- `lg:` (1024px): Full 3-column layout with sidebar
  </action>
  <verify>
```bash
cd /Users/taylermelvin/Desktop/sol-battles/web && pnpm build 2>&1 | head -50
```
Build passes. Responsive classes applied.
  </verify>
  <done>SpectatorView has mobile-first responsive layout with proper breakpoints.</done>
</task>

<task type="auto">
  <name>Task 2: Add collapsible chart section</name>
  <files>web/src/components/SpectatorView.tsx</files>
  <action>
Make the chart section collapsible, especially for mobile:

1. Add state for chart visibility:
```tsx
const [isChartExpanded, setIsChartExpanded] = useState(false);
```

2. Replace the existing Chart Card section with a collapsible version:
```tsx
{/* Chart Section - Collapsible on mobile, always visible on desktop */}
<Card className="p-0 overflow-hidden">
  {/* Header - Always visible */}
  <button
    onClick={() => setIsChartExpanded(!isChartExpanded)}
    className="w-full flex items-center justify-between p-3 sm:p-4 border-b border-border-primary bg-bg-tertiary/50 lg:cursor-default"
  >
    <div className="flex items-center gap-2">
      <span className="text-xs text-text-tertiary uppercase tracking-wider">Price Chart</span>
      {/* Asset buttons */}
      <div className="hidden sm:flex gap-1">
        {['SOL', 'BTC', 'ETH'].map((asset) => (
          <button
            key={asset}
            onClick={(e) => { e.stopPropagation(); setSelectedAsset(asset); }}
            className={`px-2 py-1 rounded text-xs font-semibold transition-all ${
              selectedAsset === asset
                ? 'bg-accent text-bg-primary'
                : 'text-text-secondary hover:text-text-primary'
            }`}
          >
            {asset}
          </button>
        ))}
      </div>
    </div>
    {/* Collapse indicator - only on mobile/tablet */}
    <div className="lg:hidden flex items-center gap-2 text-text-tertiary">
      <span className="text-xs">{isChartExpanded ? 'Collapse' : 'Expand'}</span>
      <svg
        className={`w-4 h-4 transition-transform ${isChartExpanded ? 'rotate-180' : ''}`}
        fill="none" viewBox="0 0 24 24" stroke="currentColor"
      >
        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 9l-7 7-7-7" />
      </svg>
    </div>
  </button>

  {/* Chart Content - Conditional visibility */}
  <div className={`transition-all duration-300 overflow-hidden ${
    isChartExpanded ? 'h-[250px] sm:h-[300px]' : 'h-0 lg:h-[350px]'
  }`}>
    <TradingViewChart symbol={selectedAsset} />
  </div>
</Card>
```

3. On desktop (lg:), the chart is always visible with full height.
   On mobile/tablet, it starts collapsed and can be expanded.

4. Update TradingViewChart to handle the minimal prop if it exists, or use default.

This satisfies VIEW-04 (price chart overlay) and VIEW-05 (mobile-responsive layout).
  </action>
  <verify>
```bash
cd /Users/taylermelvin/Desktop/sol-battles/web && pnpm build 2>&1 | head -50
```
Build passes. Chart section is collapsible with proper responsive behavior.
  </verify>
  <done>Chart is collapsible on mobile, always visible on desktop. Mobile layout is optimized.</done>
</task>

</tasks>

<verification>
After both tasks:
1. `pnpm build` passes in web directory
2. Mobile viewport: Single column, chart collapsed by default, stacked content
3. Tablet viewport (md): Fighter cards side-by-side, chart expandable
4. Desktop viewport (lg): Full 3-column layout, chart always visible
5. Safe-area padding at bottom for quick bet strip
</verification>

<success_criteria>
- VIEW-04: Price chart overlay visible (collapsed by default on mobile, expanded on desktop)
- VIEW-05: Mobile-responsive layout with proper breakpoints
- Collapsible chart toggle works on mobile
- No horizontal scroll on any viewport
- Bottom padding reserves space for quick bet strip
</success_criteria>

<output>
After completion, create `.planning/phases/11-spectator-experience/11-03-SUMMARY.md`
</output>
