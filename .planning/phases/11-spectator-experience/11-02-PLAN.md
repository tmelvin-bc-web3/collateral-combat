---
phase: 11-spectator-experience
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - web/src/components/spectate/SpectatorPnLBar.tsx
  - web/src/components/SpectatorView.tsx
autonomous: true

must_haves:
  truths:
    - "Spectator sees tug-of-war PnL visualization showing which fighter is winning"
    - "Rope position moves based on PnL delta between fighters"
    - "Danger zones show Trophy icon when fighter near victory, Skull when near defeat"
  artifacts:
    - path: "web/src/components/spectate/SpectatorPnLBar.tsx"
      provides: "Spectator-specific tug-of-war PnL visualization"
      exports: ["SpectatorPnLBar"]
    - path: "web/src/components/SpectatorView.tsx"
      provides: "Enhanced spectator view with tug-of-war bar"
      contains: "SpectatorPnLBar"
  key_links:
    - from: "web/src/components/SpectatorView.tsx"
      to: "SpectatorPnLBar"
      via: "import and render above battle header"
      pattern: "<SpectatorPnLBar"
---

<objective>
Adapt the PnL tug-of-war visualization from Phase 10 for spectator view with neutral fighter labels.

Purpose: Spectators need immediate visual feedback on who is winning - the tug-of-war metaphor makes this instantly clear without reading numbers.

Output: SpectatorPnLBar component integrated at top of SpectatorView.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/11-spectator-experience/11-RESEARCH.md
@.planning/phases/10-battle-core/10-05-SUMMARY.md

# Source component to adapt
@web/src/components/battle/PnLComparisonBar.tsx
@web/src/components/battle/types.ts
@web/src/components/SpectatorView.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create SpectatorPnLBar component</name>
  <files>web/src/components/spectate/SpectatorPnLBar.tsx</files>
  <action>
Create a spectator-specific tug-of-war bar by adapting PnLComparisonBar from Phase 10.

Key changes from participant version:
1. Replace "You" / "Opponent" labels with "Fighter 1" / "Fighter 2"
2. Add wallet address display (truncated) next to each label
3. Use neutral color scheme (green for leading, red for trailing, orange for tied)
4. Keep the same rope physics:
   - ropePosition = 50 + (delta * 2), clamped to 10-90%
   - Danger zones at 20% and 80%
   - Spring animation: cubic-bezier(0.34, 1.56, 0.64, 1)

Props interface:
```typescript
interface SpectatorPnLBarProps {
  fighter1: {
    pnl: number;
    pnlDollar: number;
    wallet: string;
  };
  fighter2: {
    pnl: number;
    pnlDollar: number;
    wallet: string;
  };
}
```

Implementation:
- Copy the visual structure from PnLComparisonBar
- Update labels to show "Fighter 1" / "Fighter 2"
- Add truncated wallet (formatWallet pattern: `${addr.slice(0,4)}...${addr.slice(-4)}`)
- Keep Trophy/Skull icons for danger zones
- Maintain mobile responsiveness (sm: breakpoints)

Import lucide-react icons: ChevronLeft, ChevronRight, Skull, Trophy
  </action>
  <verify>
```bash
cd /Users/taylermelvin/Desktop/sol-battles/web && pnpm build 2>&1 | head -50
```
Component compiles without TypeScript errors.
  </verify>
  <done>SpectatorPnLBar.tsx exists with neutral fighter labels and same tug-of-war mechanics as Phase 10.</done>
</task>

<task type="auto">
  <name>Task 2: Integrate SpectatorPnLBar into SpectatorView</name>
  <files>web/src/components/SpectatorView.tsx</files>
  <action>
Add the SpectatorPnLBar to SpectatorView:

1. Import SpectatorPnLBar from '@/components/spectate/SpectatorPnLBar'

2. Add SpectatorPnLBar directly after the "Main Battle Header" div (line ~136), before the grid layout:
```tsx
{/* Tug-of-War PnL Bar */}
<SpectatorPnLBar
  fighter1={{
    pnl: player1Pnl,
    pnlDollar: (player1?.account.closedPnl || 0) + (player1?.account.positions.reduce((sum, p) => sum + p.unrealizedPnl, 0) || 0),
    wallet: player1?.walletAddress || '',
  }}
  fighter2={{
    pnl: player2Pnl,
    pnlDollar: (player2?.account.closedPnl || 0) + (player2?.account.positions.reduce((sum, p) => sum + p.unrealizedPnl, 0) || 0),
    wallet: player2?.walletAddress || '',
  }}
/>
```

3. Place it inside a wrapper div with margin: `<div className="mb-6">...</div>`

The tug-of-war bar should appear prominently between the battle header (with timer/players) and the main content grid.

This satisfies VIEW-02 (real-time PnL delta visualization with tug-of-war metaphor).
  </action>
  <verify>
```bash
cd /Users/taylermelvin/Desktop/sol-battles/web && pnpm build 2>&1 | head -50
```
Build succeeds. SpectatorView includes SpectatorPnLBar.
  </verify>
  <done>SpectatorView renders SpectatorPnLBar with fighter PnL data, showing tug-of-war visualization.</done>
</task>

</tasks>

<verification>
After both tasks:
1. `pnpm build` passes in web directory
2. SpectatorPnLBar shows on spectator view above content grid
3. Rope position reflects PnL delta (winner side pulls rope toward them)
4. Danger zones show appropriate icons (Trophy/Skull)
5. Mobile responsive (smaller text/icons on mobile)
</verification>

<success_criteria>
- VIEW-02: Real-time PnL delta visualization (tug-of-war) visible to spectators
- Rope physics match Phase 10: 50% center, max 40% swing, clamped 10-90%
- Spring animation on rope movement
- Fighter 1/2 labels with truncated wallets
</success_criteria>

<output>
After completion, create `.planning/phases/11-spectator-experience/11-02-SUMMARY.md`
</output>
