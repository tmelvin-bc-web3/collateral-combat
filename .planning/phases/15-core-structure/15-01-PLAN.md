---
phase: 15-core-structure
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - web/src/components/navigation/BottomNavBar.tsx
  - web/src/components/navigation/index.ts
  - web/src/app/layout.tsx
  - web/src/types/navigation.ts
autonomous: true
user_setup: []

must_haves:
  truths:
    - "User sees bottom navigation bar with 4 tabs on mobile viewport"
    - "User taps any nav tab and navigates to that section without page reload"
    - "All touch targets are minimum 44px for accessibility"
    - "Active tab shows context-aware highlight state"
    - "Navigation bar is fixed to bottom on mobile, hidden on desktop (top nav remains)"
  artifacts:
    - path: "web/src/components/navigation/BottomNavBar.tsx"
      provides: "Bottom tab navigation component"
      min_lines: 80
      exports: ["BottomNavBar"]
    - path: "web/src/components/navigation/index.ts"
      provides: "Navigation barrel export"
      exports: ["BottomNavBar"]
    - path: "web/src/types/navigation.ts"
      provides: "Navigation type definitions"
      contains: "NavTab"
  key_links:
    - from: "web/src/app/layout.tsx"
      to: "web/src/components/navigation/BottomNavBar.tsx"
      via: "import and render in layout"
      pattern: "import.*BottomNavBar"
    - from: "web/src/components/navigation/BottomNavBar.tsx"
      to: "next/navigation"
      via: "usePathname for active state"
      pattern: "usePathname"
---

<objective>
Implement mobile-first bottom tab navigation with Arena/Watch/Fight/Profile tabs.

Purpose: Establish the foundational navigation pattern for v2.1's "UFC of crypto trading" experience. Research shows 72% of users prefer bottom navigation over hamburger menus, and this is the critical mobile UX foundation.

Output: BottomNavBar component integrated into app layout, visible on mobile viewports with proper touch targets and active states.
</objective>

<execution_context>
@/Users/taylermelvin/.claude/get-shit-done/workflows/execute-plan.md
@/Users/taylermelvin/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/research/SUMMARY.md

# Existing files to understand current patterns
@web/src/app/layout.tsx
@web/src/components/Header.tsx
@web/src/components/Footer.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create navigation types and BottomNavBar component</name>
  <files>
    web/src/types/navigation.ts
    web/src/components/navigation/BottomNavBar.tsx
    web/src/components/navigation/index.ts
  </files>
  <action>
Create the navigation types and BottomNavBar component:

1. Create `web/src/types/navigation.ts`:
   - Define `NavTab` type with: id, label, href, icon (React component or string)
   - Define `NAV_TABS` constant with 4 tabs:
     - Arena: href="/" (home/hub with fight card)
     - Watch: href="/spectate" (spectator experience)
     - Fight: href="/battle" (compete/matchmaking)
     - Profile: href="/profile/[wallet]" (user profile - will need wallet address)

2. Create `web/src/components/navigation/BottomNavBar.tsx`:
   - 'use client' directive (needs usePathname, useWallet)
   - Import usePathname from next/navigation for active state detection
   - Import useWallet from @solana/wallet-adapter-react for profile link
   - Fixed positioning at bottom: `fixed bottom-0 left-0 right-0 z-50`
   - Only show on mobile: `md:hidden` (desktop keeps top Header)
   - Background with blur: `bg-bg-primary/95 backdrop-blur-sm border-t border-rust/30`
   - Grid layout for 4 equal tabs: `grid grid-cols-4`
   - Each tab button:
     - Minimum 44px height and touchable area (NAV-02)
     - Flex column with icon above label
     - Active state: text-fire, inactive: text-text-tertiary
     - Subtle scale animation on tap: `active:scale-[0.95]`
     - transition-colors for smooth state changes
   - Icons: Use simple SVG icons matching existing NavIcon pattern in Header.tsx:
     - Arena: stadium/home icon
     - Watch: eye icon
     - Fight: lightning bolt icon
     - Profile: user icon
   - For Profile tab, construct href dynamically: `/profile/${walletAddress}` or `/profile` if not connected
   - Context-aware active detection:
     - Arena: active when pathname === '/'
     - Watch: active when pathname.startsWith('/spectate')
     - Fight: active when pathname.startsWith('/battle') || pathname.startsWith('/challenges') || pathname.startsWith('/tournaments')
     - Profile: active when pathname.startsWith('/profile')

3. Create `web/src/components/navigation/index.ts`:
   - Barrel export: `export { BottomNavBar } from './BottomNavBar';`

Design notes:
- Follow existing "wasteland" aesthetic (rust colors, dark bg)
- Use existing Tailwind custom colors: text-fire, bg-rust, border-rust, etc.
- Touch feedback is critical - use active:scale and transition
  </action>
  <verify>
Run `cd /Users/taylermelvin/Desktop/sol-battles/web && pnpm typecheck` - should pass with no errors related to new files
  </verify>
  <done>
BottomNavBar component exists with 4 tabs, proper touch targets (44px min), and context-aware active states
  </done>
</task>

<task type="auto">
  <name>Task 2: Integrate BottomNavBar into app layout</name>
  <files>
    web/src/app/layout.tsx
  </files>
  <action>
Integrate the BottomNavBar into the root layout:

1. Import BottomNavBar: `import { BottomNavBar } from '@/components/navigation';`

2. In the "Live Mode" section (non-COMING_SOON), add BottomNavBar AFTER the Footer component:
   ```tsx
   <Footer />
   <BottomNavBar />  {/* Add this line */}
   <BalanceBar />
   ```

3. Adjust main element padding for mobile to account for bottom nav:
   - Current: `pb-24`
   - Update to: `pb-24 md:pb-24 pb-[calc(4rem+env(safe-area-inset-bottom))]` on mobile
   - Actually simpler: just add extra padding on mobile: `pb-32 md:pb-24`
   - The extra padding ensures content isn't hidden behind bottom nav

4. Consider z-index stacking:
   - Header: z-50 (existing)
   - BottomNavBar: z-50 (same level, different positions)
   - BalanceBar: check current z-index, may need adjustment if it overlaps

5. Safe area inset for notched devices:
   - Add `pb-[env(safe-area-inset-bottom)]` to BottomNavBar for iPhone notch safety
   - Or use Tailwind's safe area utilities if available
  </action>
  <verify>
Run `cd /Users/taylermelvin/Desktop/sol-battles/web && pnpm build` - build should succeed. Then manually verify in browser at mobile viewport (375px width) that bottom nav appears.
  </verify>
  <done>
BottomNavBar renders in layout, visible on mobile viewport, content has proper padding to not be obscured
  </done>
</task>

<task type="auto">
  <name>Task 3: Add swipe gesture support for navigation</name>
  <files>
    web/src/components/navigation/BottomNavBar.tsx
    web/src/hooks/useSwipeNavigation.ts
  </files>
  <action>
Add horizontal swipe gesture support for navigating between tabs (NAV-04):

1. Create `web/src/hooks/useSwipeNavigation.ts`:
   - Custom hook that detects horizontal swipe gestures
   - Parameters: onSwipeLeft callback, onSwipeRight callback, threshold (default 50px)
   - Use touch events: touchstart, touchmove, touchend
   - Track start X position on touchstart
   - Calculate delta on touchend
   - If delta > threshold, trigger swipe callback
   - Return ref to attach to swipeable element
   - Prevent vertical scroll interference (only trigger on mostly-horizontal swipes)

2. Update BottomNavBar.tsx to use swipe navigation:
   - Import useSwipeNavigation hook
   - Import useRouter from next/navigation for programmatic navigation
   - Define tab order array: ['/', '/spectate', '/battle', '/profile/[wallet]']
   - Get current tab index based on pathname
   - On swipe left: navigate to next tab (if not at end)
   - On swipe right: navigate to previous tab (if not at start)
   - Attach swipe ref to a wrapper div around the nav content
   - Add subtle haptic-style feedback class on swipe (optional - CSS pulse)

3. Handle edge cases:
   - Don't swipe if at first/last tab
   - Replace [wallet] placeholder with actual wallet address or omit if not connected
   - Consider debouncing to prevent rapid swipes

Note: Swipe gestures are a nice-to-have enhancement. If implementation proves complex, a simpler version without swipe is acceptable for v1. The core requirement is that swipe COULD work, not that it's mandatory for navigation.
  </action>
  <verify>
Run typecheck: `cd /Users/taylermelvin/Desktop/sol-battles/web && pnpm typecheck` - should pass
  </verify>
  <done>
Swipe gesture hook exists and is integrated with BottomNavBar for left/right navigation between tabs
  </done>
</task>

</tasks>

<verification>
After all tasks complete:

1. TypeScript check: `cd /Users/taylermelvin/Desktop/sol-battles/web && pnpm typecheck`
2. Build check: `cd /Users/taylermelvin/Desktop/sol-battles/web && pnpm build`
3. Visual verification (manual):
   - Open localhost:3000 in browser
   - Set viewport to 375px width (mobile)
   - Confirm bottom nav bar visible with 4 tabs
   - Tap each tab, confirm navigation works without full page reload
   - Confirm active state changes appropriately
   - Verify touch targets feel accessible (not too small)
</verification>

<success_criteria>
- [ ] BottomNavBar component renders on mobile viewport (< 768px)
- [ ] 4 tabs visible: Arena, Watch, Fight, Profile
- [ ] Tapping any tab navigates to correct route
- [ ] Navigation is client-side (no full page reload)
- [ ] Active tab shows highlighted state (text-fire)
- [ ] All touch targets are at least 44px
- [ ] Desktop viewport shows only top Header (bottom nav hidden)
- [ ] Swipe gesture navigates between adjacent tabs
- [ ] Build and typecheck pass
</success_criteria>

<output>
After completion, create `.planning/phases/15-core-structure/15-01-SUMMARY.md`
</output>
