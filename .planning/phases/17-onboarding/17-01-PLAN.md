---
phase: 17-onboarding
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - web/src/components/onboarding/FloatingConnectPill.tsx
  - web/src/components/onboarding/PostConnectFeedback.tsx
  - web/src/components/onboarding/index.ts
  - web/src/components/watch/BattleFeed.tsx
  - web/src/app/watch/page.tsx
autonomous: true

must_haves:
  truths:
    - "User can watch live battles without wallet connected"
    - "Floating connect pill appears when wallet not connected"
    - "User can dismiss floating pill"
    - "Clicking pill opens wallet selection modal"
    - "After connecting, user sees balance and deposit prompt"
  artifacts:
    - path: "web/src/components/onboarding/FloatingConnectPill.tsx"
      provides: "Floating wallet connect button"
      min_lines: 50
    - path: "web/src/components/onboarding/PostConnectFeedback.tsx"
      provides: "Post-connect balance display with deposit prompt"
      min_lines: 30
  key_links:
    - from: "web/src/components/onboarding/FloatingConnectPill.tsx"
      to: "useWalletModal"
      via: "setVisible(true) on click"
      pattern: "setVisible\\(true\\)"
    - from: "web/src/components/watch/BattleFeed.tsx"
      to: "FloatingConnectPill"
      via: "render when wallet not connected"
      pattern: "FloatingConnectPill"
---

<objective>
Create anonymous spectator experience with floating wallet connect pill

Purpose: Allow new users to experience the platform without wallet friction while providing a gentle, non-blocking prompt to connect
Output: FloatingConnectPill component, PostConnectFeedback component, integration with watch experience
</objective>

<execution_context>
@/Users/taylermelvin/.claude/get-shit-done/workflows/execute-plan.md
@/Users/taylermelvin/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/17-onboarding/17-CONTEXT.md
@.planning/phases/17-onboarding/17-RESEARCH.md
@web/src/components/WalletProvider.tsx
@web/src/components/watch/BattleFeed.tsx
@web/src/hooks/useSessionBetting.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create FloatingConnectPill component</name>
  <files>
    web/src/components/onboarding/FloatingConnectPill.tsx
    web/src/components/onboarding/index.ts
  </files>
  <action>
Create FloatingConnectPill.tsx in new onboarding/ directory:

1. Client component that renders when wallet is NOT connected
2. Fixed position pill button above QuickBetStrip (bottom-24 to clear the betting UI)
3. Dismissible via X button (state stored in component, resets on page navigation)
4. Orange/warning colored to match app accent
5. Shows wallet icon + "Connect to bet"
6. On click: calls useWalletModal().setVisible(true) to open standard wallet modal
7. Include plain language reassurance text: "Your funds stay in your wallet until you wager"
8. Safe area padding for mobile: style={{ paddingBottom: 'env(safe-area-inset-bottom)' }}
9. Animate in with fade-in animation

Implementation notes from CONTEXT.md:
- All wallets shown equally (no Phantom prominence) - standard modal handles this
- Floating pill should feel like a gentle nudge, not blocking content
- Use existing pattern from QuickBetStripV2 for z-index (z-40 or z-30 to be below bet strip)

Create index.ts barrel export for onboarding components.
  </action>
  <verify>
File exists with proper imports. Run `cd /Users/taylermelvin/Desktop/sol-battles/web && pnpm typecheck` passes.
  </verify>
  <done>
FloatingConnectPill renders orange pill button with wallet icon and dismissable X, opens wallet modal on click.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create PostConnectFeedback component</name>
  <files>
    web/src/components/onboarding/PostConnectFeedback.tsx
  </files>
  <action>
Create PostConnectFeedback.tsx for balance display after wallet connect:

1. Client component that shows immediately after wallet connects
2. Uses useSessionBetting() to get balanceInSol
3. Displays: "Connected! Balance: X.XX SOL"
4. If balance is 0: Shows prominent deposit prompt button
5. If balance > 0: Shows subtle "Ready to bet" confirmation
6. Style: Success green border/bg for connected state
7. Auto-dismiss after 5 seconds OR on deposit button click
8. Position: Toast-style at top of screen or inline in FloatingConnectPill area

From CONTEXT.md:
- Zero balance users: deposit-first flow â€” guide them to deposit before anything else
- Balance + deposit prompt immediately after connect

Use toast-style positioning (fixed top-4 center) with glass-morphism background.
  </action>
  <verify>
File exists. Run `cd /Users/taylermelvin/Desktop/sol-battles/web && pnpm typecheck` passes.
  </verify>
  <done>
PostConnectFeedback shows balance confirmation, displays deposit prompt when balance is zero, auto-dismisses.
  </done>
</task>

<task type="auto">
  <name>Task 3: Integrate onboarding components into watch experience</name>
  <files>
    web/src/components/watch/BattleFeed.tsx
    web/src/app/watch/page.tsx
  </files>
  <action>
Wire FloatingConnectPill and PostConnectFeedback into the watch experience:

1. In BattleFeed.tsx or watch/page.tsx (whichever renders the battle view):
   - Import FloatingConnectPill from '@/components/onboarding'
   - Render FloatingConnectPill (it self-manages visibility based on wallet state)

2. In same location:
   - Import PostConnectFeedback
   - Track "just connected" state: show PostConnectFeedback for 5 seconds after wallet connects
   - Use useEffect watching wallet.connected state transition from false to true

3. Verify anonymous experience:
   - BattleFeed already works without wallet (QuickBetStripV2 shows "Connect wallet to bet")
   - Chat should be read-only for anonymous users (existing behavior)
   - No changes needed for spectating itself

4. Ensure z-index layering:
   - BattleSlide content: z-0/z-10
   - FloatingConnectPill: z-30
   - QuickBetStripV2: z-40
   - Wallet modal: z-50 (handled by wallet adapter)
  </action>
  <verify>
Run `cd /Users/taylermelvin/Desktop/sol-battles/web && pnpm build` succeeds.
Manual: Navigate to /watch without wallet connected - should see battles + floating pill.
  </verify>
  <done>
Watch experience shows FloatingConnectPill when disconnected, PostConnectFeedback appears briefly after connecting, anonymous users can spectate without interruption.
  </done>
</task>

</tasks>

<verification>
1. `pnpm typecheck` passes in web/
2. `pnpm build` succeeds
3. Anonymous user can view /watch page without wallet prompt blocking content
4. FloatingConnectPill appears at bottom of screen (above QuickBetStrip)
5. Clicking pill opens wallet modal with all wallet options
6. Dismissing pill hides it
7. After connecting wallet, PostConnectFeedback shows balance
8. Zero balance shows deposit prompt
</verification>

<success_criteria>
- ONB-01: Anonymous spectating works without any blocking prompts
- ONB-02: One-click wallet connect via floating pill
- ONB-03: Plain language explanation visible near connect button
- ONB-08: Post-connect balance display with deposit prompt for zero balance users
</success_criteria>

<output>
After completion, create `.planning/phases/17-onboarding/17-01-SUMMARY.md`
</output>
