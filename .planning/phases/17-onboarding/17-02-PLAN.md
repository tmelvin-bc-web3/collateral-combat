---
phase: 17-onboarding
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - web/src/hooks/useFirstBet.ts
  - web/src/contexts/FirstBetContext.tsx
  - web/src/components/watch/QuickBetStripV2.tsx
  - web/src/hooks/useBetState.ts
  - web/src/app/layout.tsx
autonomous: true

must_haves:
  truths:
    - "First bet amount defaults to 0.05 SOL for new users"
    - "Confetti animation triggers on first successful bet"
    - "First bet state persists in localStorage per wallet"
    - "Session key creation happens without user-facing prompts"
  artifacts:
    - path: "web/src/hooks/useFirstBet.ts"
      provides: "First bet detection and tracking hook"
      min_lines: 40
    - path: "web/src/contexts/FirstBetContext.tsx"
      provides: "First bet state context for app-wide access"
      min_lines: 30
  key_links:
    - from: "web/src/components/watch/QuickBetStripV2.tsx"
      to: "useFirstBet"
      via: "recordFirstBet() on successful bet"
      pattern: "recordFirstBet"
    - from: "web/src/components/watch/QuickBetStripV2.tsx"
      to: "useConfetti"
      via: "triggerConfetti() on first bet"
      pattern: "triggerConfetti"
---

<objective>
Implement first bet detection with celebration animation and preset amounts

Purpose: Track first bet per user, celebrate the milestone, and guide new users with appropriate defaults
Output: useFirstBet hook, FirstBetContext, integration with QuickBetStripV2 for celebration and defaults
</objective>

<execution_context>
@/Users/taylermelvin/.claude/get-shit-done/workflows/execute-plan.md
@/Users/taylermelvin/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/17-onboarding/17-CONTEXT.md
@.planning/phases/17-onboarding/17-RESEARCH.md
@web/src/components/Confetti.tsx
@web/src/components/watch/QuickBetStripV2.tsx
@web/src/hooks/useBetState.ts
@web/src/hooks/useSessionBetting.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create useFirstBet hook and FirstBetContext</name>
  <files>
    web/src/hooks/useFirstBet.ts
    web/src/contexts/FirstBetContext.tsx
  </files>
  <action>
Create useFirstBet.ts hook:

```typescript
// Key functionality:
const FIRST_BET_KEY = 'sol_battles_first_bet_completed';

export function useFirstBet() {
  // 1. Check localStorage for first bet completion (key includes wallet address)
  // 2. hasPlacedFirstBet: boolean - true if user has ever placed a bet
  // 3. showCelebration: boolean - true when we should show confetti
  // 4. recordFirstBet(): void - call on successful bet, sets localStorage, triggers celebration
  // 5. dismissCelebration(): void - call after celebration shown
  // 6. isFirstBetUser: boolean - true if connected and has NOT placed first bet
}
```

Implementation:
1. Use wallet publicKey from useWallet() to make localStorage key per-wallet
2. Check localStorage on mount and when wallet changes
3. recordFirstBet sets localStorage, updates state, sets showCelebration=true
4. dismissCelebration sets showCelebration=false
5. Return all state and functions

Create FirstBetContext.tsx:
1. Wrap useFirstBet functionality in context for app-wide access
2. Provider component that wraps children
3. Export useFirstBetContext() hook for consuming

This allows both QuickBetStripV2 and ProfileContext to access first bet state.
  </action>
  <verify>
Files exist. Run `cd /Users/taylermelvin/Desktop/sol-battles/web && pnpm typecheck` passes.
  </verify>
  <done>
useFirstBet hook tracks first bet per wallet using localStorage, provides recordFirstBet/dismissCelebration functions, FirstBetContext makes state accessible app-wide.
  </done>
</task>

<task type="auto">
  <name>Task 2: Wire first bet celebration into QuickBetStripV2</name>
  <files>
    web/src/components/watch/QuickBetStripV2.tsx
    web/src/hooks/useBetState.ts
  </files>
  <action>
Modify QuickBetStripV2 to handle first bet celebration:

1. Import useFirstBetContext from '@/contexts/FirstBetContext'
2. Import useConfetti from '@/components/Confetti'
3. In QuickBetStripV2:
   - Get { hasPlacedFirstBet, recordFirstBet, showCelebration, dismissCelebration } from useFirstBetContext()
   - Get { triggerConfetti, ConfettiComponent } from useConfetti()

4. On successful bet (state === 'success' in useBetState or onSuccess callback):
   - Check if !hasPlacedFirstBet
   - If true: call recordFirstBet() then triggerConfetti()

5. Render ConfettiComponent in the component output

6. Default bet amount for new users (ONB-04):
   - If !hasPlacedFirstBet (first time user), pre-select 0.05 SOL (second preset)
   - Modify initial selectedAmount in useBetState or QuickBetStripV2:
     - Pass isFirstBetUser to useBetState
     - In useBetState, set initial selectedAmount to 0.05 if isFirstBetUser, else keep current default (0.1)

From CONTEXT.md:
- Default bet amount: 0.05 SOL (second preset) pre-selected for new users
- Celebration after first bet should feel rewarding but quick â€” don't interrupt the action for too long
- Confetti duration is already 3000ms in useConfetti, which is appropriate
  </action>
  <verify>
Run `cd /Users/taylermelvin/Desktop/sol-battles/web && pnpm typecheck` passes.
  </verify>
  <done>
QuickBetStripV2 triggers confetti on first successful bet, defaults to 0.05 SOL for new users.
  </done>
</task>

<task type="auto">
  <name>Task 3: Add FirstBetProvider to app layout</name>
  <files>
    web/src/app/layout.tsx
  </files>
  <action>
Add FirstBetProvider to the app's provider hierarchy:

1. Import FirstBetProvider from '@/contexts/FirstBetContext'
2. Add FirstBetProvider inside the existing provider chain
3. Place it AFTER WalletProvider (needs wallet context) and BEFORE other providers that might use it

Provider order should be:
```tsx
<WalletProvider>
  <AuthProvider>
    <ProfileProvider>
      <FirstBetProvider>
        {/* rest of app */}
      </FirstBetProvider>
    </ProfileProvider>
  </AuthProvider>
</WalletProvider>
```

This ensures FirstBetProvider has access to wallet state and ProfileProvider can access first bet state (needed for Plan 03).
  </action>
  <verify>
Run `cd /Users/taylermelvin/Desktop/sol-battles/web && pnpm build` succeeds.
  </verify>
  <done>
FirstBetProvider is in the app's provider chain, making first bet state available throughout the application.
  </done>
</task>

</tasks>

<verification>
1. `pnpm typecheck` passes in web/
2. `pnpm build` succeeds
3. New user (no localStorage entry) sees 0.05 SOL pre-selected
4. On first successful bet, confetti animation plays
5. localStorage entry created after first bet
6. Returning user does NOT see celebration on subsequent bets
7. FirstBetContext accessible from any component in the app
</verification>

<success_criteria>
- ONB-04: First bet guided flow with 0.05 SOL pre-selected for new users
- ONB-05: Celebration animation triggers on first successful bet only
- ONB-07: Session key creation happens silently (existing useSessionBetting behavior, no new prompts)
</success_criteria>

<output>
After completion, create `.planning/phases/17-onboarding/17-02-SUMMARY.md`
</output>
